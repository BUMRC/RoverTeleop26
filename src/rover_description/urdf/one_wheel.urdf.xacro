<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="one_wheel_test">

  <!-- Parameters you can override from launch -->
  <xacro:arg name="can_interface" default="can0"/>
  <xacro:arg name="wheel_radius" default="0.10"/>
  <xacro:arg name="wheel_width"  default="0.05"/>

  <!-- AK45-36 constants (override if you swap actuator model) -->
  <xacro:property name="pole_pairs" value="14"/>
  <xacro:property name="gear_ratio" value="36.0"/>
  <xacro:property name="kt" value="0.11"/>

  <link name="base_link">
    <visual>
      <geometry>
        <box size="0.2 0.2 0.05"/>
      </geometry>
    </visual>
  </link>

  <link name="wheel_link">
    <visual>
      <!-- Cylinder axis is along Z; rotate so wheel axle is along Y -->
      <origin rpy="1.57079632679 0 0"/>
      <geometry>
        <cylinder radius="${wheel_radius}" length="${wheel_width}"/>
      </geometry>
    </visual>
  </link>

  <joint name="wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_link"/>
    <origin xyz="0 0 ${wheel_radius}" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- ros2_control: connect this joint to our hardware plugin -->
  <ros2_control name="CubeMarsAKSystem" type="system">
    <hardware>
      <plugin>cubemars_ak_hardware/CubeMarsAKSystemHardware</plugin>
      <param name="can_interface">${can_interface}</param>
    </hardware>

    <joint name="wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
      <state_interface name="temperature"/>

      <!-- Motor-specific -->
      <param name="can_id">0x01</param>
      <param name="pole_pairs">${pole_pairs}</param>
      <param name="gear_ratio">${gear_ratio}</param>
      <param name="kt">${kt}</param>

      <!-- Flip if it spins opposite your expectation -->
      <param name="direction">1</param>

      <!-- Optional: clamp joint velocity (rad/s) before converting to ERPM -->
      <param name="vel_limit">20.78</param>
    </joint>
  </ros2_control>

</robot>
